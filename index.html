<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard Greenhouse SMKN 8 Pekanbaru</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-doughnutlabel@latest"></script>
  //<script src="http://cdn.rawgit.com/Mikhus/canvas-gauges/gh-pages/download/2.1.7/all/gauge.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-gauges@2.1.7/gauge.min.js"></script>
</head>
<body>
  <header>
    <h1>Dashboard Greenhouse SMKN 8 Pekanbaru</h1>
    <p>Monitoring Suhu, Kelembaban, Tekanan, Tanah, dan Pompa</p>
  </header>

  <body>

    <div class="content">
        <div class="card-grid">
            <div class="card">
                <p class="card-title">Temperature 
                  <br/>(Â°C) <br/>
              </p>
                <canvas id="gauge-temperature" width="200" height="200"></canvas>
            </div>
            <div class="card">
                <p class="card-title">Kelembaban Udara (%)</p>
                <canvas id="gauge-humidity" width="200" height="200"></canvas>
            </div>
            <div class="card">
                <p class="card-title">Tekanan Udara (hPa)</p>
                <canvas id="gauge-pressure" width="200" height="200"></canvas>
            </div>
            <div class="card">
                <p class="card-title">Intensitas Cahaya (Lux)</p>
                <canvas id="gauge-light" width="200" height="200"></canvas>
            </div>
            <div class="card">
                <p class="card-title">Kelembaban Tanah (%)</p>
                <canvas id="gauge-soil-moisture" width="200" height="200"></canvas>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
    <script>
        // Inisialisasi gauge untuk setiap sensor
        var temperatureGauge = new Gauge("gauge-temperature").setOptions({
            angle: 0.15,
            lineWidth: 0.44,
            radiusScale: 1,
            pointer: {
                length: 0.6,
                strokeWidth: 0.035,
                color: "#000000"
            },
            limitMax: false,
            limitMin: false,
            highDpiSupport: true,
            strokeColor: "#E0E0E0",
            generateGradient: true
        });
        temperatureGauge.setMinValue(0);
        temperatureGauge.setMaxValue(100);
        temperatureGauge.set(0); // Set initial value

        var humidityGauge = new Gauge("gauge-humidity").setOptions({
            angle: 0.15,
            lineWidth: 0.44,
            radiusScale: 1,
            pointer: {
                length: 0.6,
                strokeWidth: 0.035,
                color: "#000000"
            },
            limitMax: false,
            limitMin: false,
            highDpiSupport: true,
            strokeColor: "#E0E0E0",
            generateGradient: true
        });
        humidityGauge.setMinValue(0);
        humidityGauge.setMaxValue(100);
        humidityGauge.set(0); // Set initial value

        var pressureGauge = new Gauge("gauge-pressure").setOptions({
            angle: 0.15,
            lineWidth: 0.44,
            radiusScale: 1,
            pointer: {
                length: 0.6,
                strokeWidth: 0.035,
                color: "#000000"
            },
            limitMax: false,
            limitMin: false,
            highDpiSupport: true,
            strokeColor: "#E0E0E0",
            generateGradient: true
        });
        pressureGauge.setMinValue(950);
        pressureGauge.setMaxValue(1050);
        pressureGauge.set(0); // Set initial value

        var pressureGauge = new Gauge("gauge-pressure").setOptions({
            angle: 0.15,
            lineWidth: 0.44,
            radiusScale: 1,
            pointer: {
                length: 0.6,
                strokeWidth: 0.035,
                color: "#003366"
            },
            staticZones: [
               {strokeStyle: "#30B32D", min: 950, max: 980}, // Good
               {strokeStyle: "#FFDD00", min: 980, max: 1010}, // Warning
               {strokeStyle: "#F03E3E", min: 1010, max: 1050}  // Danger
            ],
            limitMax: true,
            limitMin: true,
            highDpiSupport: true
        });
        pressureGauge.setMinValue(950);
        pressureGauge.setMaxValue(1050);
        pressureGauge.set(1013); // Average sea level pressure

      var lightGauge = new Gauge("gauge-light").setOptions({
            angle: 0.15,
            lineWidth: 0.44,
            radiusScale: 1,
            pointer: {
                length: 0.6,
                strokeWidth: 0.035,
                color: "#FFA500"
            },
            colorPlate: "#222",
            colorMajorTicks: "#f5f5f5",
            highlights: [
                {from: 0, to: 1000, color: "rgba(0,150,136,0.3)"},     // Low light
                {from: 1000, to: 5000, color: "rgba(255,235,59,0.3)"}, // Medium
                {from: 5000, to: 10000, color: "rgba(255,87,34,0.3)"}  // Bright
            ],
            highDpiSupport: true
        });
        lightGauge.setMinValue(0);
        lightGauge.setMaxValue(10000);
        lightGauge.set(5000); // Medium light
      
       var soilMoistureGauge = new Gauge("gauge-soil-moisture").setOptions({
            angle: 0.15,
            lineWidth: 0.44,
            radiusScale: 1,
            pointer: {
                length: 0.6,
                strokeWidth: 0.035,
                color: "#8D6E63"
            },
            staticZones: [
                {strokeStyle: "#F44336", min: 0, max: 20},    // Dry
                {strokeStyle: "#FF9800", min: 20, max: 50},   // Getting dry
                {strokeStyle: "#8BC34A", min: 50, max: 80},   // Optimal
                {strokeStyle: "#2196F3", min: 80, max: 100}   // Wet
            ],
            highDpiSupport: true
        });
        soilMoistureGauge.setMinValue(0);
        soilMoistureGauge.setMaxValue(100);
        soilMoistureGauge.set(50); // Optimal moisture

        // Fungsi untuk memperbarui nilai gauge dari sensor
        function updateGauges(data) {
            temperatureGauge.set(data.temperature);
            humidityGauge.set(data.humidity);
            pressureGauge.set(data.pressure);
            lightGauge.set(data.light);
            soilMoistureGauge.set(data.soilMoisture);
        }

        // Contoh data untuk pengujian
        setInterval(() => {
      const mockData = {
        temperature: Math.random() * 50,
        humidity: Math.random() * 100,
        pressure: 950 + Math.random() * 100,
        light: Math.random() * 10000,
        soilMoisture: Math.random() * 100
      };
      gaugeTemp.value = mockData.temperature;
      gaugeHum.value = mockData.humidity;
      gaugePressure.value = mockData.pressure;
      gaugeLight.value = mockData.light;
      gaugeSoil.value = mockData.soilMoisture;
    }, 2000);

    // EventSource for real-time updates
    if (!!window.EventSource) {
      var source = new EventSource('/events');
      source.addEventListener('open', function(e) {
        console.log("Events Connected");
      }, false);
      source.addEventListener('error', function(e) {
        if (e.target.readyState != EventSource.OPEN) {
          console.log("Events Disconnected");
        }
      }, false);
      source.addEventListener('message', function(e) {
        console.log("message", e.data);
      }, false);
      source.addEventListener('new_readings', function(e) {
        console.log("new_readings", e.data);
        var myObj = JSON.parse(e.data);
        gaugeTemp.value = myObj.temperature;
        gaugeHum.value = myObj.humidity;
        gaugePressure.value = myObj.pressure;
        gaugeLight.value = myObj.light;
        gaugeSoil.value = myObj.soilMoisture;
      }, false);
    }

    // Load readings on page load
    window.addEventListener('load', getReadings);
    </script>
</body>
  
  <footer>
    <p>&copy; 2025 SMKN 8 Pekanbaru</p>
  </footer>

  <script src="script.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-doughnutlabel@latest"></script>
</script>

</html>
